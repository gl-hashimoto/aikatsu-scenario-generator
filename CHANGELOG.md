# 更新履歴

## v3.1.6 (2025-11-13)

### バグ修正
- 🐛 **ジョブ管理のバグ修正**
  - 失敗したジョブが表示されない問題を修正
  - 「失敗したジョブ」セクションを追加
  - エラー内容を表示できるように改善
  - story_tips.txt のキャッシュ問題を修正（use_cache=False）

### 改善
- エラーが発生したジョブの詳細が確認できるように
- 失敗したジョブを削除できるボタンを追加

---

## v3.1.5 (2025-11-13)

### 改善
- 📝 **story_tips.txt の大幅強化**
  - 心理学・マーケティング理論を追加（アンカリング効果、AIDAの法則、カリギュラ効果、損失回避）
  - あらすじを面白くする5原則を詳細化
    - 具体的な数字で「リアリティ」を出す
    - ターゲットが「共感」する立場を明確にする
    - 最初の3行で「絶望的な状況」を提示する（AIDAの法則）
    - 「禁断」と「タブー」の香りをさせる（カリギュラ効果）
    - SNSで「バズる」キーワードをフックにする
  - オチを面白くする5原則を詳細化
    - 「逆転」「自滅」「どんでん返し」のパターン選択
    - 社会的・経済的制裁で「スカッと度」を最大化
    - 感情の落差を激しくする（損失回避の逆）
    - リアリティラインを死守する
    - 10P漫画の「完璧な終わり方」
  - Good例・NG例をより具体的に記載
  - ターゲット層（30〜45歳女性）に特化した内容に

---

## v3.1.4 (2025-11-13)

### 新機能
- 📝 **ストーリーTipsファイルの分離**
  - あらすじやオチを面白くするためのプロンプトを別ファイルに分離
  - `prompts/theme_generation/story_tips.txt` を作成
  - 独立して編集・更新が可能に

### 改善
- あらすじを面白くする5つのコツを明文化
- オチを面白くする5つのコツを明文化
- Good例・NG例を追加して具体性を向上
- テーマ生成時に自動的にstory_tipsを読み込む仕組みを実装

---

## v3.1.3 (2025-11-13)

### 改善
- 🔢 **ジョブのナンバリング表示**
  - 実行中のジョブに番号を表示（#1, #2, ...）
  - 完了したジョブに番号を表示
  - どのジョブか一目で識別可能に

---

## v3.1.2 (2025-11-13)

### 改善
- 📝 **テーマ生成の出力形式を改善**
  - より実用的でシンプルな形式に変更
  - 「オチの内容」と「そのオチが面白い理由」を明記
  - 不要な項目（ヒット要素、予想PV、難易度など）を削除
  - 記事制作時に必要な情報に特化

### 変更内容
- 出力形式: ヒット要素・元記事との関連・予想PV・難易度を削除
- 追加項目: オチの内容（具体的な結末）、そのオチが面白い理由

---

## v3.1.1 (2025-11-13)

### 新機能
- ✨ **バックグラウンドジョブ機能**
  - 記事分析をバックグラウンドで実行
  - **ページ遷移しても処理が継続**
  - 実行中のジョブを監視するUI
  - 進捗状況をリアルタイム表示（0%→100%）
  - 完了したジョブを履歴に保存

### 改善
- 🔄 記事分析の非同期化
  - threading.Threadでバックグラウンド実行
  - ジョブの状態を`data/jobs.json`に永続化
  - スレッドセーフなジョブ管理

- 🎨 UIの改善
  - 「実行中のジョブ」セクションを追加
  - プログレスバーで進捗を視覚化
  - キャンセル・削除ボタン

### 技術的改善
- 📦 ジョブ管理モジュールの追加 (`utils/job_manager.py`)
- 🔧 バックグラウンドタスク処理の実装

---

## v3.1.0 (2025-11-13)

### 新機能
- ✨ **記事分析＆ネタ展開の履歴機能**
  - 分析結果を保存・管理できる機能を追加
  - タイトルをクリックで詳細表示
  - リスト形式で過去の分析をすべて確認可能
  - Markdown形式でダウンロード可能

- ✨ **シナリオ生成の履歴機能**
  - 生成したシナリオを保存・管理できる機能を追加
  - タイトルをクリックで詳細表示
  - 生成パラメータも保存され、後から確認可能
  - リスト形式で過去のシナリオをすべて確認可能

- ✨ **恋愛縛りの実装**
  - すべてのプロンプトに「恋愛」要素を必須化
  - 基本分析、深堀り分析、新テーマ生成のすべてで恋愛観点を強化
  - 恋愛メディアとしての一貫性を確保

### 改善
- 💾 データ永続化の強化
  - 分析履歴: `data/analysis_history.json`
  - シナリオ履歴: `data/scenario_history.json`
  - WEB上でログが残り、いつでも見返せる

- 🎨 UIの改善
  - 記事分析ページに「新規分析」「分析履歴」タブを追加
  - 履歴一覧からワンクリックで詳細表示
  - 削除機能を追加

### 技術的改善
- 📦 シナリオ管理モジュールの追加 (`utils/scenario_manager.py`)
- 🔧 分析履歴管理機能の実装 (`pages/article_analysis.py`)

---

## v3.0.1 (2025-11-11)

### バグ修正
- 🐛 **Streamlit CloudでのAPI認証エラーを修正**
  - `st.secrets.get()` の使用方法を修正
  - Streamlit Cloudとローカル環境の両方に対応
  - try-exceptで適切にエラーハンドリング

### 改善
- 📝 設定ページにStreamlit Cloud用の詳細な設定手順を追加
- 💡 APIキーの読み込み元を明示（Secrets or .env）

---

## v3.0.0 (2025-11-10)

### 新機能
- ✨ **💡 新テーマ提案機能** を追加
  - ヒットデータから「隣地拡張」「飛び地挑戦」の2方向で新テーマを提案
  - 既存の延長だけでなく、新しい可能性も探索
  - AIが過去データを分析してジャンル・テーマの組み合わせを提案

### 改善
- 🔐 APIキーの永続化機能
  - .envファイルに自動保存
  - アプリ再起動後も保持
  - 削除機能も追加

- 💾 セッション状態管理の強化
  - ページ切り替えてもデータが消えない
  - サイドバーにデータ読み込み状況を表示
  - データクリアボタンを追加

- 📊 データ分析の改善
  - 数値変換エラーの修正
  - 空データのハンドリング改善

### その他
- 📌 バージョン表示機能を追加
- 📝 .gitignoreファイルを作成
- 📄 CHANGELOGファイルを作成

---

## v2.0.0 (2025-11-10)

### 新機能
- ✅ LINE配信シート専用の分析機能を実装
- ✅ ジャンル別・記事種別分析を追加
- ✅ AIシナリオ生成機能を実装（Claude API）
- ✅ ヒット記事Top 20分析を追加

### 改善
- 実際の愛カツデータ形式に完全対応
- 複数シート対応

---

## v1.0.0 (2025-11-10)

### 初期リリース
- ✅ 基本的なデータ分析機能
- ✅ CSV/Excelアップロード機能
- ✅ PV・CTR分析
- ✅ ヒット記事の特徴抽出

---

## バージョン番号の規則（セマンティックバージョニング）

修正が反映されているか確認しやすくするため、**すべての変更でバージョンを更新**します。

### X.Y.Z の意味

- **メジャーバージョン (X.0.0)**: 大きな機能追加・破壊的変更
  - 例: v2.0.0 → v3.0.0（バックグラウンドジョブシステムの導入）

- **マイナーバージョン (0.X.0)**: 新機能追加
  - 例: v3.0.0 → v3.1.0（履歴機能の追加）

- **パッチバージョン (0.0.X)**: バグ修正・小さな改善・UI調整
  - 例: v3.1.0 → v3.1.1（UIの改善、出力形式の変更、表示の調整など）

### 更新頻度

- 修正のたびにバージョンを更新（パッチバージョンアップ）
- 新機能追加時はマイナーバージョンアップ
- 大規模な変更時はメジャーバージョンアップ

---

## 次回予定（v3.1.0以降）

### 計画中の機能
- ⏳ バッチ生成機能（1日10本以上）
- ⏳ 重複チェック機能
- ⏳ 生成履歴管理
- ⏳ マンネリ防止アルゴリズム
- ⏳ A/Bテスト機能
- ⏳ 外部サイトトレンド分析
